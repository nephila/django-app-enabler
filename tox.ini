[tox]
envlist = docs,black,pep8,isort,pydocstyle,py{38,37,36,35}-django{30,22}
minversion = 3.5.0
skip_missing_interpreters = true
skipsdist = True

[testenv]
alwayscopy = True
commands =
    - {envpython} -mpip uninstall -y app_enabler
    - {envpython} -mpip install -r requirements-test.txt
    - {env:COMMAND_PRE:python -c "print('test start')"}
    {env:COMMAND:python} cms_helper.py test {posargs}
    - {env:COMMAND_POST:python -c "print('test end')"}
deps =
    -rrequirements-test.txt
    django22: Django>=2.2,<3.0
    django30: Django>=3.0,<3.1
passenv =
    TERM
    TERMINFO
    PIP_CACHE_DIR
    PIP_INDEX_URL
    PIP_EXTRA_INDEX_URL
    COMMAND
    COMMAND_PRE
    COMMAND_POST
    BUILD_DIR
setenv =
    PYTHONDONTWRITEBYTECODE = 1

[testenv:pep8]
commands =
    {envpython} -mflake8
deps =
    flake8
    flake8-broken-line
    flake8-bugbear
    flake8-builtins
    flake8-coding
    flake8-comprehensions
    flake8-eradicate
    flake8-quotes
    flake8-tidy-imports
    pep8-naming
skip_install = true

[testenv:pydocstyle]
commands = {envpython} -mpydocstyle app_enabler
deps = pydocstyle
skip_install = true

[testenv:isort]
commands =
    {envpython} -misort -c -rc -df
deps = isort
skip_install = true

[testenv:isort_format]
commands =
    {envpython} -misort -rc -y
deps = {[testenv:isort]deps}
skip_install = true

[testenv:black]
commands =
    {envpython} -mblack --check --diff .
deps = black
skip_install = true

[testenv:black_format]
commands =
    {envpython} -mblack .
deps = {[testenv:black]deps}
skip_install = true

[testenv:docs]
basepython = python3.7
commands =
    - {envpython} -mpip install -r requirements-test.txt
    {envpython} -msphinx -W -b html -d {envtmpdir}/doctrees docs {env:BUILD_DIR:docs/_build/html}
deps =
    -rrequirements-test.txt

[pydocstyle]
convention = pep257
# http://www.pydocstyle.org/en/stable/error_codes.html
add_ignore = D100,D101,D104,D105,D106,D107,D412,D200
add_select = D204,D205,D214,D413

[isort]
line_length = 119
skip = migrations, .tox, node_modules, docs, conf, urls, settings
combine_as_imports = true
default_section = THIRDPARTY
include_trailing_comma = true
known_first_party = nphfab
multi_line_output = 3
force_grid_wrap = 0
use_parentheses = True
not_skip = __init__.py

[flake8]
exclude = ./.*,**/migrations/*,settings/*,**/*settings.py,manage.py,fabfile.py,conf/*,urls/*,.tox, node_modules, docs, deployment.py, tree_example.py
max-line-length = 119
# flake8-quotes
inline-quotes = double
# flake8-coding
no-accept-encodings = True
# flake8-tidy-imports
banned-modules = __future__ = this project supports python3 only
ignore = E800, C408
